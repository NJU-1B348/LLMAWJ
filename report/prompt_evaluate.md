# GPT3.5 Prompt Evaluate by jwz

## 测试对象与目的

在`GPT3.5Prompt_jwz.md`中设计的GPT3.5Prompt，用于评估该组Prompt对于"Never Free"警报的评估能力。

## 测试方法

1. 按照`GPT3.5Prompt_jwz.md`中的设计，将Prompt逐步输入给GPT3.5，最终输入某个测试用例。
2. 保证在每次输入Prompt1-3之后，只输入一个测试用例并记录GPT3.5返回的结果。
3. 在测试另一个测试用例之前，新建new chat，重新输入提示Prompt1-3。
4. 记录GPT的返回结果，包括GPT给出的警报 True or False, 以及该处发生内存泄漏的可能性。
5. 每个测试用例**独立测试三次**，记录结果并统计，以探索利用多个对话降低GPT随机性的可能。
6. 根据结果统计评估该组Prompt的效果。

## 测试用例

测试用例是从 Apache Httpd 和仓库[SVF-tools/Test-Suite](https://github.com/SVF-tools/Test-Suite/tree/master)中选取的13个内存泄露警报，类型均为"Never Free Leak"。其中警报有真实警报，也有误报。在对来自SVF-tools/Test-Suite的警报进行测试时，由于原测试用例代码中使用了类似`NFRMALLOC` `SAVEMALLOC`等宏定义标注该处是否是安全的malloc操作，为了避免该信息干扰GPT3.5对于警报真实性的判断，将这些宏定义替换为`MACROMALLOC`。

测试用例见`test_case.md`

## 测试结果

### 符号解释

|    符号     |                  解释                   |
| :---------: | :-------------------------------------: |
| $J_{real}$  |         测试用例的正确判断结果          |
|   $J_{i}$   |    第$i$次测试中GPT3.5给出的判断结果    |
|   $P_{i}$   | 第$i$次测试中GPT3.5给出的内存泄漏可能性 |
|  $\bar{P}$  |    GPT3.5给出的内存泄漏可能性平均值     |
| $J_\bar{P}$ |  根据$\bar{P}$总结的GPT3.5综合判断结果  |

### 测试结果

| Test Case ID | $J_{real}$ | $J_1$ | $P_1$  | $J_2$ | $P_2$  | $J_3$ | $P_3$  | $\bar{P}$ | $J_\bar{P}$ |
| -----------: | ---------- | ----- | ------ | ----- | ------ | ----- | ------ | --------- | ----------- |
|            1 | $F$        | $T$   | $0.80$ | $F$   | $0.20$ | $F$   | $0.10$ | $0.37$    | $F$         |
|            2 | $F$        | $F$   | $0.10$ | $F$   | $0.10$ | $F$   | $0.10$ | $0.10$    | $F$         |
|            3 | $F$        | $F$   | $0.15$ | $T$   | $0.85$ | $F$   | $0.10$ | $0.37$    | $F$         |
|            4 | $F$        | $F$   | $0.10$ | $F$   | $0.10$ | $T$   | $0.90$ | $0.37$    | $F$         |
|            5 | $F$        | $F$   | $0.10$ | $F$   | $0.10$ | $F$   | $0.10$ | $0.10$    | $F$         |
|            6 | $F$        | $T$   | $0.85$ | $F$   | $0.10$ | $F$   | $0.10$ | $0.35$    | $F$         |
|            7 | $T$        | $T$   | $0.95$ | $T$   | $1.00$ | $T$   | $0.95$ | $0.97$    | $T$         |
|            8 | $T$        | $T$   | $0.90$ | $T$   | $0.90$ | $T$   | $0.90$ | $0.90$    | $T$         |
|            9 | $T$        | $T$   | $1.00$ | $T$   | $1.00$ | $T$   | $1.00$ | $1.00$    | $T$         |
|           10 | $T$        | $T$   | $1.00$ | $T$   | $0.95$ | $T$   | $0.95$ | $0.97$    | $T$         |
|           11 | $F$        | $T$   | $1.00$ | $F$   | $0.30$ | $T$   | $1.00$ | $0.76$    | $T$         |
|           12 | $T$        | $T$   | $1.00$ | $T$   | $0.90$ | $T$   | $0.90$ | $0.93$    | $T$         |
|           13 | $T$        | $T$   | $0.95$ | $T$   | $0.95$ | $T$   | $0.95$ | $0.95$    | $T$         |

$J_\bar{P}$的平均准确度为$CR_{J_\bar{P}} = 92.3\%$

说明该Prompt判断"Never Free Leak"还是比较准确的，其中测试样例11是从正确的代码中伪造的静态分析警报，可能该警报不符合GPT的认识，导致GPT的判断错误。

同时发现利用多个对话与GPT交互可以减小随机性对结果产生的影响。
